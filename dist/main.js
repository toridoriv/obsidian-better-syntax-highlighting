//@ts-nocheck
var c=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var i=(r,e)=>c(r,"name",{value:e,configurable:!0});var A=(r,e)=>{for(var t in e)c(r,t,{get:e[t],enumerable:!0})},L=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of O(e))!R.call(r,n)&&n!==t&&c(r,n,{get:()=>e[n],enumerable:!(o=N(e,n))||o.enumerable});return r};var v=r=>L(c({},"__esModule",{value:!0}),r);var G={};A(G,{default:()=>D});module.exports=v(G);var a=require("obsidian");var x=require("obsidian");function M(r){return r[0]}i(M,"first");function b(r,e){let t=typeof r=="string"?new RegExp(r,"g"):new RegExp(r.source,r.flags||"g");return[...e.matchAll(t)].map(M)}i(b,"matchAll");function f(r){let e=r.split(/<\S*>/),t=b(/<\S*>.*<\/\S*>/,r),o=document.createDocumentFragment();for(let n of e){let m=t.find(y=>y.includes(n)),g=k(m||`<span>${n}</span>`);o.appendChild(g)}return o}i(f,"getMessageFragment");function k(r){return new DOMParser().parseFromString(r.trim(),"text/html").getElementsByTagName("body")[0].firstChild||document.createElement("span")}i(k,"stringToHtml");var s=class r{constructor(e){this.plugin=e}static{i(this,"Announcer")}static#e=null;static plugin;static initialize(e){this.#e||(this.plugin=e,this.#e=new r(this.plugin))}static get instance(){if(!this.#e)throw new Error("Announcer not initialized");return this.#e}createNotice(e,t=1e4){let o=typeof e=="string"?f(e):e,n=document.createElement("footer");return n.textContent=this.plugin.manifest.name+" Plugin",n.style.fontSize="xx-small",n.style.opacity="0.5",n.style.borderTop="1px solid var(--text-muted)",n.style.marginTop="1em",n.style.paddingTop="0.5em",n.style.textAlign="right",o.appendChild(n),new x.Notice(o,t)}success(e,t=15e3){return this.createNotice(`‚ú® ${e}`,t)}info(e,t=15e3){return this.createNotice(`üí¨ ${e}`,t)}failure(e,t=15e3){return this.createNotice(`‚ùå ${e}`,t)}warn(e,t=1e4){let o=document.createDocumentFragment(),n=document.createElement("span");return n.innerHTML="‚ö†Ô∏è",n.classList.add("emoji"),o.append(n," ",f(e)),this.createNotice(o,t)}cannotRun(e,t){return this.warn(`The task <strong><u>${e}</u></strong> cannot be run ${t}.`)}error(e,t,o=2e4){return this.failure(`<p>${e}</p><code>${JSON.stringify({name:t.name,message:t.message,cause:t.cause},null,2)}</code>`,o)}};var d=class r{constructor(e,t){this.name=e;this.pattern=t}static{i(this,"LanguageToken")}aliases=[];static from(e){return Object.create(r.prototype,Object.getOwnPropertyDescriptors(e))}setAliases(...e){return this.aliases.push(...e),this}toLanguageDefinition(){return{alias:this.aliases,pattern:this.pattern}}toModeRule(){return{regex:this.pattern,token:this.name}}},p=class{constructor(e){this.name=e}static{i(this,"Language")}tokens=[];aliases=[];get modeName(){return this.name.toLowerCase().replaceAll(" ","-")}addToken(e){return e instanceof d||(e=d.from(e)),this.tokens.push(e),this}addAliases(...e){return this.aliases.push(...e),this}registerOn(e){return I(e)?this.registerOnCodemirror(e):this.registerOnPrism(e)}isThisModeInfo=i(e=>e.mode===this.modeName||e.name.toLowerCase()===this.modeName,"isThisModeInfo");registerOnCodemirror(e){e.defineSimpleMode(this.modeName,this.toCodeMirrorSimpleMode());let t=this.toCodemirrorModeInfo(e.modeInfo.find(this.isThisModeInfo));e.defineMIME(t.mime,this.modeName),e.modeInfo.push(t)}registerOnPrism(e){e.languages[this.modeName]=this.toPrismDefinition()}toPrismDefinition(){let e={};for(let t of this.tokens)e[t.name]=t.toLanguageDefinition();return e}toCodeMirrorSimpleMode(){let e=[];for(let t of this.tokens)e.push(t.toModeRule());return{start:e}}toCodemirrorModeInfo(e){return e||{name:this.name,mode:this.modeName,mime:`text/x-${this.modeName}`,ext:this.aliases,alias:[...this.aliases,this.modeName]}}};function I(r){return typeof r=="function"&&r.name==="CodeMirror"}i(I,"isCodemirror");var w=new p("Sourcegraph Query").addAliases("sgq","sourcegraph").addToken({name:"property",pattern:/(repo|file):/gm}).addToken({name:"operator",pattern:/AND|OR|-/gm});var C=[w];function h(r,e){let t=r[e],o={pattern:/^\b$/};return t?t instanceof RegExp?{pattern:t}:Array.isArray(t)?o:t:o}i(h,"getGrammarToken");function P(){let r="if (stream != state.thisLine.stream)",{CodeMirror:e}=window,t=e.modes.markdown;if(t.isPatch)return;let o=t.toString(),n=o.indexOf(r),m=o.substring(0,n).replace("function(cmCfg, modeCfg)",""),g=o.substring(n),S=[m,"state.quote = 0;",g].join("").replace("modeCfg.strikethrough = false;","modeCfg.strikethrough = true;"),u=new Function("cmCfg","modeCfg",`"use strict"; return function markdown(cmCfg, modeCfg) ${S};`)();Object.defineProperty(u,"dependencies",{enumerable:!0,configurable:!0,value:["xml"]}),Object.defineProperty(u,"isPatch",{enumerable:!1,configurable:!1,value:!0}),e.defineMode("markdown",u);for(let E of C)E.registerOn(e)}i(P,"patchCodeMirror");function j(r){let e=r.languages.markdown,t={...h(e,"bold"),pattern:/\*{2}[^\n\r]+\*{2}|_{2}[^\n\r]+_{2}/gm,alias:["inline"]},o={...h(e,"italic"),pattern:/\*{1}[^\n\r *]{1,}[^\n\r*]+[^\n\r *]{1,}\*{1}(?!.*\*)|_{1}[^\n\r _]{1,}[^\n\r_]+[^\n\r _]{1,}_{1}(?!.*_)/gm,alias:["inline"]},n={blockquote:{alias:["block","thematic-break"],pattern:/^[ \t]{0,}>{1,} ?[^\n\r]*[\n|\r]{0,}/gm,inside:{bold:t,italic:o}},bold:t,italic:o,list:{...h(e,"list"),alias:["block","thematic-break"],pattern:/^[ \t]{0,}(\d{1,}\. [^\n\r]*[\n|\r]{0,1}|[-*+] [^\n\r]*[\n|\r]{0,1})/gm,greedy:!1,lookbehind:!1,inside:{bold:t,italic:o}}};r.languages.markdown=r.languages.extend("markdown",n),r.languages.md=r.languages.extend("md",n)}i(j,"patchMarkdown");function T(r){j(r);for(let e of C)e.registerOn(r)}i(T,"patchPrism");var l=class extends a.Plugin{static{i(this,"BetterSyntaxHighlighting")}onload(){s.initialize(this),this.app.workspace.onLayoutReady(async()=>{try{let e=this.app.workspace.getActiveViewOfType(a.MarkdownView),t=await(0,a.loadPrism)();P(),T(t),e&&e.file&&e.previewMode.rerender(!0),t.highlightAll()}catch(e){if(e instanceof Error){s.instance.error(e?.message,e);return}s.instance.error("Something went wrong",e)}})}};var D=l;
